<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/webjars/jquery/3.3.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="/webjars/angularjs/1.6.9/angular.js"></script>
    <script src="/webjars/angularjs/1.6.9/angular-resource.js"></script>
    <script src="/webjars/angularjs/1.6.9/angular-route.js"></script>
    <link th:href="@{/webjars/bootstrap/4.1.0/css/bootstrap.min.css}" rel="stylesheet" media="screen"/>
    <link th:href="@{/webjars/select2/select2.css}" rel="stylesheet" media="screen"/>

    <script src="webjars/bower/select2/4.0.3/select2.js" type="text/javascript"></script>
    <script src="/webjars/bootstrap/4.1.0/js/bootstrap.js"></script>
    <link href="/css/content.css" th:href="@{/css/content.css}" rel="stylesheet" media="screen"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
    <title>OpenFossball</title>
</head>

<body ng-app="new_match" style="padding-top: 40px">
<div class="content">
    <div ng-controller="MainCtrl">
        <!-- Navigation -->
        <div th:include="navbar"></div>
        <!-- Navigation --->

        <div class="container">

            <!-- Page Content -->
            <div class="row">

                <div class="col-lg-12">

                    <div class="card bg-dark text-white mt-4">
                        <div class="card-header text-center">
                            <h2>New Match</h2>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h3 class="card-title">Your Team</h3>
                                </div>
                                <div class="col-md-6">
                                    <h3 class="card-title float-right">Opponent Team</h3>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="row">
                                        <label for='select_player_one_your_team' class="card-text">Player 1:</label>
                                        <br>
                                        <select id='select_player_one_your_team' class="select2_class" name="state" ng-model="loggedPlayer" ng-options="player.username for player in username_vector">
                                        </select>
                                    </div>
                                    <div class="row">
                                        <label for='select_player_two_your_team' class="card-text">Player 2:</label>
                                        <br>
                                        <select id='select_player_two_your_team' class="select2_class" name="state" ng-model="t1p2" ng-options="player.username for player in username_vector ">
                                        </select>
                                    </div>

                                </div>
                                <div class="col-md-1">
                                    <input id="current_team_score" style="width:40px" class="text-center">
                                </div>
                                <div class="col-md-1">
                                    <input id="opponent_team_score" style="width:40px" class="text-center">
                                </div>

                                <div class="col-md-5">
                                    <div class="row">
                                        <label for='select_player_one_opponent_team' class="card-text float-right">Player 1:</label>
                                        <br>
                                        <select id='select_player_one_opponent_team' class="float-right select2_class"  name="state" ng-model="requestedPlayer" ng-options="player.username for player in username_vector ">
                                        </select>
                                    </div>
                                    <div class="row">
                                        <label for='select_player_two_opponent_team' class="card-text">Player 2:</label>
                                        <br>
                                        <select id='select_player_two_opponent_team' class="select2_class" name="state" ng-model="t2p2" ng-options="player.username for player in username_vector ">
                                        </select>
                                    </div>
                                </div>
                            </div>


                            <form>
                                <label class="radio"><input type="radio" name="optradio"
                                                            id="radioButton_tournamentMatch">Tournament Match</label>
                                <label class="radio"><input type="radio" name="optradio"
                                                            id="radioButton_regularMatch">Regular Match</label>
                                <label class="radio"><input type="radio" name="optradio"
                                                            id="radioButton_trainingMatch">Training Match</label>
                            </form>

                            <div class="row">
                                <div class="col-md-12 text-right">
                                    <button ng-click="create_request()" id ="createRequestButton" class="btn btn-info" th:text="'Create Request'"></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /.card -->
                </div>
                <!-- /.col-lg-9 -->
            </div>

        </div>
        <!-- /.container -->

        <!-- Footer -->
        <div th:include="footer"></div>
        <!-- Footer --->

    </div>
</div>
<script th:inline="javascript">
    var dataLayer = [];
</script>
<script th:each="user: ${players_vector}" th:inline="javascript">
    dataLayer.push({'username': [[${user.getUserName()}]]});
</script>
<script th:inline="javascript">
    console.log(dataLayer); // do whatever you want with dataLayer...
</script>

<script type="text/javascript">
    $(document).ready(function () {
        $(".select2_class").select2({
            placeholder: "Select a project..."
        })
            .on("change", function (e) {
                console.log("Elo changed select2 :D")
            });

        $("#select_player_one_your_team").select2("enable",false);



    });
</script>
<script>

    var mymodal = angular.module('new_match', []);


    mymodal.controller('MainCtrl', ['$scope', '$http', function ($scope, $http) {

        $scope.logged_player = "[[${logged_player}]]";
        $scope.requested_player = "[[${requested_player}]]";

        $scope.username_vector = dataLayer;
        console.log($scope.username_vector);

        $scope.loggedPlayer= $scope.username_vector[$scope.logged_player];
        $scope.requestedPlayer = $scope.username_vector[$scope.requested_player];


        $scope.t1p2 = {};
        $scope.t2p2 = {};


        $scope.create_request = function (){
            var p1t1 = $scope.loggedPlayer;
            var p2t1 = $scope.t1p2;
            var p1t2 = $scope.requestedPlayer;
            var p2t2 = $scope.t2p2;

            var currentTeamValue = document.getElementById("current_team_score").value;
            var opponentTeamValue = document.getElementById("opponent_team_score").value;
            console.log(p1t1);
            console.log(p2t1);
            console.log(p1t2);
            console.log(p2t2);
            console.log(currentTeamValue);
            console.log(opponentTeamValue);
            $http.post('/new_match/create_match', {"player_one_your_team": 'elo',
                "player_two_your_team": p2t1,
                "player_one_opponent_team": p1t2,
                "player_two_opponen_team": p2t2,
                "currentTeamValue": currentTeamValue,
                "opponentTeamValue": opponentTeamValue
            })
                .then($scope.successCallback, $scope.errorCallback);
        };

        $scope.successCallback = function () {
            console.log("sukcjes");
        };

        $scope.errorCallback = function () {
            console.log("errjor");
        };


    }]);

</script>
</body>
</html>